<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unglish Word Generator Demo</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --heading-color: #1a1a1a;
            --code-bg: #f0f0f0;
            --code-color: #333333;
        }
    
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #1a1a1a;
                --text-color: #e0e0e0;
                --heading-color: #ffffff;
                --code-bg: #2a2a2a;
                --code-color: #e0e0e0;
            }
        }
    
        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
    
        h2 {
            color: var(--heading-color);
        }
    
        code {
            background-color: var(--code-bg);
            color: var(--code-color);
            padding: 2px 4px;
            border-radius: 4px;
        }
    
        #singleWord, #haiku, #slogan, #duplicates, #wordMatchDemo {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid var(--text-color);
            border-radius: 5px;
        }
    </style>
    <script type="module">
        import unglish from '../dist/index.js';

        document.addEventListener('DOMContentLoaded', () => {
            document.body.innerHTML = `
                <div id="singleWord">Generating single word...</div>
                <div id="haiku">Generating haiku...</div>
                <div id="slogan">Generating slogan...</div>
                <div id="duplicates">Generating duplicate word search...</div>
                <div id="wordMatchDemo">
                    <h2>Word Match Demo</h2>
                    <input type="text" id="targetWord" placeholder="Enter a word">
                    <button id="startMatchDemo">Generate Match</button>
                    <div id="matchResult"></div>
                </div>
            `;

            // Function to generate a single word
            const generateSingleWord = () => {
                const singleWord = unglish.generateWord();
                console.log(singleWord);
                document.getElementById('singleWord').innerHTML = `
                    <h2>Single Word:</h2> ${singleWord.written.clean} <br/> <code>${singleWord.pronunciation}</code> <br/>
                `;
            };

            // Function to generate a single word
            const generateSlogan = () => {
                const singleWord = unglish.generateWord({syllableCount: 1});
                console.log(singleWord);

                const firstWords = [
                    "Ignore Haters —",
                    "Always", "Just", "Never", "Forever", "Never Quit —", 
                    "Passionately", "Fearlessly", "Endlessly", "Forget Fear —", 
                    "You Can", "Relentlessly",
                ];

                const lastWords = [
                    "It", "Your Dreams", "Success", "Your Enemies", "Fear", "Love", "Tomorrow", "Yourself", 
                    "The Future", "Greatness", "Excellence", "Possibilities", "Potential", "Destiny", 
                    "The World", "Your Goals", "Perfection", "Innovation", "Happiness", "Victory", "Hard Things"
                ];
                const slogan = `${firstWords[Math.floor(Math.random()*firstWords.length)]} ${singleWord.written.clean} ${lastWords[Math.floor(Math.random()*lastWords.length)]}`;
                document.getElementById('slogan').innerHTML = `
                    <h2>Slogan:</h2> 
                    <span style="text-transform: capitalize">
                        ${slogan}
                    </span>
                `;
            };

            // Function to generate a haiku
            const generateHaiku = () => {
                const haiku = [
                    [unglish.generateWord({ syllableCount: 2 }), unglish.generateWord({ syllableCount: 2 }), unglish.generateWord({ syllableCount: 1 })],
                    [unglish.generateWord({ syllableCount: 3 }), unglish.generateWord({ syllableCount: 2 }), unglish.generateWord({ syllableCount: 2 })],
                    [unglish.generateWord({ syllableCount: 2 }), unglish.generateWord({ syllableCount: 1 }), unglish.generateWord({ syllableCount: 2 })],
                ]
                console.log(haiku);
                const writtenHaiku = haiku.map(
                    line => line.map(word => word.written.clean).join(' ')
                ).join('<br/>');
                const pronouncedHaiku = haiku.map(
                    line => line.map(word => word.pronunciation).join(' ')
                ).join('<br/>');
                document.getElementById('haiku').innerHTML = `
                    <h2>Haiku:</h2> 
                    <p>${writtenHaiku}</p>
                    <code>${pronouncedHaiku}</code>
                `;
            };

            // Function to find duplicate words
            const findDuplicateWords = (iterations) => {
                const generatedWords = new Map();
                let currentIteration = 0;

                function generateWords() {
                    const batchSize = 10;
                    for (let i = 0; i < batchSize && currentIteration < iterations; i++, currentIteration++) {
                        const newWord = unglish.generateWord();
                        const wordKey = `${newWord.written.clean} (${newWord.pronunciation})`;
                        generatedWords.set(wordKey, (generatedWords.get(wordKey) || 0) + 1);
                    }

                    // Update progress
                    document.getElementById('duplicates').innerHTML = `
                        <h2>Duplicate Word Search:</h2>
                        <p>Generated ${currentIteration} of ${iterations} words...</p>
                    `;

                    if (currentIteration < iterations) {
                        requestAnimationFrame(generateWords);
                    } else {
                        finalizeDuplicates();
                    }
                }

                function finalizeDuplicates() {
                    const duplicates = Array.from(generatedWords.entries())
                        .filter(([_, count]) => count > 1)
                        .sort((a, b) => b[1] - a[1]);

                    const totalDuplicates = duplicates.reduce((sum, [_, count]) => sum + count, 0);
                    const uniqueDuplicates = duplicates.length;
                    const dupeCount = totalDuplicates-uniqueDuplicates;
                    console.log(`Total duplicates: ${totalDuplicates}, Unique duplicates: ${uniqueDuplicates}: ${dupeCount} dupes`);

                    // Format duplicates for display
                    const formattedDuplicates = duplicates
                        .map(([word, count]) => `${word} (${count})`)
                        .join(', ');

                    // Add the result to the HTML
                    document.getElementById('duplicates').innerHTML = `
                        <h2>Duplicate Word Search:</h2>
                        <p>Generated ${iterations} words.</p>
                        <p>Found ${dupeCount} dupes (${dupeCount/iterations*100}%): ${formattedDuplicates}</p>
                    `;
                }

                generateWords();
            };

            // Word Match Demo
            const targetWordInput = document.getElementById('targetWord');
            const startMatchDemoButton = document.getElementById('startMatchDemo');
            const matchResultDiv = document.getElementById('matchResult');

            let isGenerating = false;
            let attempts = 0;
            let targetWord = '';
            let closeMatches = [];
            const generatedWords = new Set();

            function generateWordUntilMatch() {
                if (!isGenerating) return;

                const batchSize = 10;
                let batchAttempts = 0;

                while (batchAttempts < batchSize) {
                    const generatedWord = unglish.generateWord().written.clean.toLowerCase();
                    attempts++;
                    batchAttempts++;

                    if (!generatedWords.has(generatedWord)) {
                        generatedWords.add(generatedWord);

                        if (generatedWord === targetWord) {
                            isGenerating = false;
                        } else if (
                            (isPartOf(generatedWord, targetWord) ||
                            isOffByOneLetter(generatedWord, targetWord))
                            && !closeMatches.includes(generatedWord)
                        ) {
                            console.log('close!', generatedWord);
                            closeMatches.push(generatedWord);
                        }

                        const matchesHtml = closeMatches
                            .map(word => `<li>${word}</li>`)
                            .join('');

                        matchResultDiv.innerHTML = 
                            `
                                <em><span>Attempts: ${attempts}</span></em>
                                ${!isGenerating ? `<br/><strong>Match found: ${generatedWord}</strong>` : ''}
                                <br/><strong>Close matches:</strong>
                                <ul>${matchesHtml}</ul>
                            `;
                    }
                }

                requestAnimationFrame(generateWordUntilMatch);
            }

            function isPartOf(word1, word2) {
                // Convert both words to lowercase for case-insensitive comparison
                word1 = word1.toLowerCase();
                word2 = word2.toLowerCase();
                
                // Check if word1 is a substring of word2
                return word1.includes(word2);
            }

            function isOffByOneLetter(word1, word2) {
                const len1 = word1.length;
                const len2 = word2.length;
                
                // If the length difference is more than 1, they can't be off by just one letter
                if (Math.abs(len1 - len2) > 1) return false;
                
                let differences = 0;
                let i = 0, j = 0;
                
                while (i < len1 && j < len2) {
                    if (word1[i] !== word2[j]) {
                        differences++;
                        if (differences > 1) return false;
                        
                        if (len1 > len2) {
                            // Possible deletion in word1
                            i++;
                        } else if (len1 < len2) {
                            // Possible insertion in word2
                            j++;
                        } else {
                            // Substitution
                            i++;
                            j++;
                        }
                    } else {
                        i++;
                        j++;
                    }
                }
                
                // If we haven't finished both words, count the remaining characters as differences
                differences += (len1 - i) + (len2 - j);
                
                return differences === 1;
            }

            startMatchDemoButton.addEventListener('click', () => {
                const newTargetWord = targetWordInput.value.trim().toLowerCase();
                if (newTargetWord) {
                    if (newTargetWord !== targetWord) {
                        targetWord = newTargetWord;
                        closeMatches = [];
                        generatedWords.clear();
                    }
                    isGenerating = true;
                    attempts = 0;
                    matchResultDiv.innerHTML = 'Generating...';
                    requestAnimationFrame(generateWordUntilMatch);
                } else {
                    matchResultDiv.innerHTML = 'Please enter a target word.';
                }
            });

            // Schedule tasks to run after the initial paint
            requestAnimationFrame(() => {
                generateSingleWord();
                generateSlogan();
                generateHaiku();
                findDuplicateWords(5000);
            });
        });
    </script>
</head>
<body>
    <!-- The generated content will be inserted here -->
</body>
</html>